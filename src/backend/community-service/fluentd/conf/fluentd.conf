<source>
  @type tail
  format json
  path /var/log/*.log
  pos_file /var/pos/service.pos
  tag fluentdlog.*
  refresh_interval 5s
</source>

<match **>
  @type copy
  <store>
    @type elasticsearch
    hosts http://10.99.19.2:9200
    <buffer service, time>
      @type file
      path /var/buffer/elasticsearch
      timekey 30s
      flush_mode interval
      flush_interval 5s
      flush_thread_count 5
      retry_type exponential_backoff
      retry_forever false
      retry_wait 1
      retry_exponential_backoff_base 2
      retry_randomize true
      retry_max_interval 5m
      retry_timeout 72h
    </buffer>
    index_name fluentd-${service}-%Y%m%d
    include_tag_key true
    type_name access_log
    tag_key @log_name
    flush_interval 1s
    reconnect_on_error true
    reload_on_failure true
    reload_connections false
  </store>

  <store>
    @type stdout
  </store>
</match>